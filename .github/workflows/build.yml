on:
    push:
        tags:
            - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10
    workflow_dispatch:   # Run manually

jobs:
    build:
        runs-on: ubuntu-latest
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        steps:
        - name: Checkout
          uses: actions/checkout@v2

        - name: Zip Data Pack
          uses: montudor/action-zip@v1
          with:
            args: zip -qq -r creeper-birthday-party-datapack-${{ github.ref_name }}.zip $GITHUB_WORKSPACE/datapacks/creeper-birthday-party/ -i data/* pack.*

        - name: Zip Resource Pack
          uses: montudor/action-zip@v1
          with:
            args: zip -qq -r creeper-birthday-party-resourcepack-${{ github.ref_name }}.zip $GITHUB_WORKSPACE/resourcepacks/creeper-birthday-party/ -i assets/* pack.* README.md

        - name: Create github Release
          id: create_release
          uses: actions/create-release@v1
          env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
              tag_name: ${{ github.ref_name }}
              release_name: ${{ github.ref_name }}
              draft: true
              prerelease: false

        - name: Upload datapack
          uses: actions/upload-release-asset@v1.0.1
          env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
              upload_url: ${{ steps.create_release.outputs.upload_url }}
              asset_path: creeper-birthday-party-datapack-${{ github.ref_name }}.zip
              asset_name: creeper-birthday-party-datapack-${{ github.ref_name }}.zip
              asset_content_type: application/zip

        - name: Upload resourcepack
          uses: actions/upload-release-asset@v1.0.1
          env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
              upload_url: ${{ steps.create_release.outputs.upload_url }}
              asset_path: creeper-birthday-party-resourcepack-${{ github.ref_name }}.zip
              asset_name: creeper-birthday-party-resourcepack-${{ github.ref_name }}.zip
              asset_content_type: application/zip

        - name: Publish release
          uses: eregon/publish-release@v1
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
            release_id: ${{ steps.create_release.outputs.id }}
